<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=0">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<title>
W ç±»å‹ (W Type)</title>
<link href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.13.13/katex.min.css" rel="stylesheet"><style>
body { max-width: 650px; margin: auto; width: 90%; margin-top: 10%; margin-bottom: 10%; color: #0B0E26; background: #FAFAFC; line-height: 2em; font-variant-ligatures: common-ligatures discretionary-ligatures; -webkit-font-feature-settings: "liga" on, "calt" on; font-feature-settings: "liga" on, "calt" on; }
body { font-family: -apple-system,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Microsoft YaHei,Source Han Sans SC,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif; }
h1 { font-size: 2.5em; color: #EF96AB; line-height: 1.5em; }
h2 { margin-top: 2em; line-height: 1.5em; }
blockquote { color: gray; margin: 0; padding: 1 1 1 20; border-left: 5px solid #EF96AB; }
code, pre { font-family: "JetBrains Mono","ç­‰è·æ›´çº±é»‘ä½“ SC","Fira Code",Menlo,Monaco,source-code-pro,Courier New,Consolas,monospace; background: #FCF6FC; border-radius: 3px; padding-inline: 0.3rem; }
pre { overflow-x: auto; padding: 1rem; }
pre>code { padding-inline: 0; }
a { color: #02AEF1; text-decoration: none; }
@media (prefers-color-scheme: dark) { body { color: #D8D8D6; background: #0E0E10; } }
@media (prefers-color-scheme: dark) { pre, code { color: #D8D8D6; background: #0E0F1F; } }
.hljs-keyword { color: #F288AF; }
.hljs-comment { color: #929CA6; }
.hljs-string { color: #0594A6; }
.hljs-title { color: #4581D9; }
.hljs-type, .hljs-built_in { color: #fca311; }
</style>
</head>
<body>
<p>
<a href="https://iota.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/niltok">ğŸ”¥GitHubğŸ”¥</a></p>
<h1 id="w-ç±»å‹-w-type">W ç±»å‹ (W Type)</h1>
<h3 id="by-ç©ç«">By ç©ç«</h3>
<p>ç®€å•æ¥è¯´ï¼ŒW ç±»å‹æ˜¯ä¸€ç§é€šç”¨çš„ç¼–ç  Dependent Inductive Type çš„æ–¹å¼ã€‚</p>
<h2 id="æ•°æ®ç±»å‹çš„å½’çº³">æ•°æ®ç±»å‹çš„å½’çº³</h2>
<p>å½’çº³æ„é€ æ•°æ®æ˜¯ä¸€ç§ä»ç®€å•æ„é€ å™¨ç»„åˆæˆæ•´ä¸ªå¯¹è±¡çš„è¿‡ç¨‹ã€‚æ¯”å¦‚åˆ—è¡¨å°±æ˜¯ç”± <code>Nil</code> å’Œ <code>Cons</code> ä¸¤ä¸ªæ„é€ å™¨ç»„åˆè€Œæˆçš„ï¼š</p>
<pre><code class="language-idris"><span class="hljs-keyword">data</span> List a = Nil | (::) a (List a)
</code></pre>
<p>è€Œå½’çº³æ„é€ çš„æ•°æ®ç±»å‹å¯ä»¥ç”¨ç»“æ„å½’çº³æ³•è¯æ˜å…¶ä¸Šçš„æ€§è´¨ï¼Œæ¯”å¦‚å¯¹äº <code>List</code> æ¥è¯´é€šç”¨çš„è¯æ˜å°±æ˜¯ï¼š</p>
<pre><code class="language-idris">indList : (P : List a -&gt; Type) -&gt; 
    (P Nil) -&gt; 
    ((x : a) -&gt; (xs : List a) -&gt; P xs -&gt; P (x :: xs)) -&gt; 
    (xs : List a) -&gt; 
    P xs
indList _ nil cons Nil = nil
indList p nil cons (x :: xs) = cons x xs (indList p nil cons xs)
</code></pre>
<p>è¿™ä¸ª <code>indList</code> ä¸­çš„ <code>P</code> å°±æ˜¯ä¸€ä¸ªä¾èµ–äºä¸€ä¸ªåˆ—è¡¨çš„å‘½é¢˜ï¼Œç”¨éå½¢å¼åŒ–çš„è¯­è¨€æè¿° <code>indList</code> å°±æ˜¯ï¼šå¦‚æœå¯¹äºç©ºè¡¨æ¥è¯´è¯¥å‘½é¢˜æˆç«‹ï¼ˆå­˜åœ¨ <code>P Nil</code>ï¼‰ä¸”å¦‚æœå¯¹äºä¸€ä¸ªåˆ—è¡¨æ¥è¯´è¯¥å‘½é¢˜æˆç«‹ï¼ˆå­˜åœ¨ <code>P xs</code>ï¼‰é‚£ä¹ˆå¯¹äºå¤šä¸€ä¸ªå…ƒç´ çš„è¯¥åˆ—è¡¨æˆç«‹ï¼ˆå­˜åœ¨ <code>P (x :: xs)</code>ï¼‰ï¼Œæ­¤æ—¶å¯ä»¥å¾—å‡ºç»“è®ºï¼Œå¯¹äºä»»æ„åˆ—è¡¨æ¥è¯´è¯¥å‘½é¢˜æˆç«‹ï¼ˆä¹Ÿå°±æ˜¯ <code>(xs : List a) -&gt; P xs</code>ï¼‰ã€‚</p>
<blockquote>
<p>æ˜æ˜ <code>P</code> æ˜¯ä¸ªäº§ç”Ÿç±»å‹çš„å‡½æ•°ï¼Œä¸ºä»€ä¹ˆè¯´å®ƒæ˜¯ä¸€ä¸ªä¾èµ–äºä¸€ä¸ªåˆ—è¡¨çš„å‘½é¢˜å‘¢ï¼Ÿå‚è€ƒ <a href="https://magic.huohuo.moe/html/CHIso.html">Curry-Howard åŒæ„</a></p>
</blockquote>
<h2 id="é€šç”¨çš„å½’çº³æ„é€ ">é€šç”¨çš„å½’çº³æ„é€ </h2>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå½’çº³æ•°æ®ç»“æ„æ„é€ å‡ºçš„å¯¹è±¡åº”å½“æ˜¯æœ‰é™çš„å¤šå‰æ ‘å½¢ç»“æ„ï¼ˆåœ¨é€šè¿‡ termination check çš„æƒ…å†µä¸‹ï¼‰ã€‚å¾ˆæ˜¾ç„¶ï¼Œä»»æ„çš„å½’çº³æ•°æ®ç»“æ„éƒ½å­˜åœ¨ä¸€ä¸ªå¤šå‰æ ‘çš„åŒæ„ï¼Œé‚£ä¹ˆå…¶å®ä»…ä»…ä½¿ç”¨é€šç”¨çš„å¤šå‰æ ‘å°±å¯ä»¥æ„é€ å‡ºä»»æ„çš„å½’çº³æ•°æ®ç»“æ„ï¼š</p>
<pre><code class="language-idris"><span class="hljs-keyword">data</span> Ind : (a : Type) -&gt; (size : a -&gt; Nat) -&gt; Type <span class="hljs-keyword">where</span>
    MkInd : (x : a) -&gt; Vect (size x) (Ind a size) -&gt; Ind a size
</code></pre>
<p>æˆ‘ä»¬æŠŠæ‰€æœ‰çš„æ„é€ å™¨çš„å‚æ•°åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†æ˜¯æ‰¿è½½çš„æ•°æ®ï¼Œå…¨éƒ¨æ‰“åŒ…æ”¾åœ¨äº† <code>x : a</code> ä¸­ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯å­åˆ†æ”¯æ•°ç»„ï¼Œè¢«æ‹†åˆ†å‡ºæ¥æ”¾åœ¨äº† <code>Vect (size x) (Ind a size)</code> ä¸­</p>
<p>è¿™é‡Œä¸¾ä¸ª <code>Ind</code> æ„é€ å‡º <code>List</code> çš„ä¾‹å­ï¼š</p>
<pre><code class="language-idris">listSize : (a : Type) -&gt; Maybe a -&gt; Nat
listSize _ Nothing = 0
listSize _ (Just _) = 1

List&#x27; : Type -&gt; Type
List&#x27; a = Ind (Maybe a) (listSize a)

nil : List&#x27; a
nil = MkInd Nothing Nil

cons : a -&gt; List&#x27; a -&gt; List&#x27; a
cons x xs = MkInd (Just x) (xs :: Nil)
</code></pre>
<p>å’Œ <code>List</code> ä¸€æ ·ï¼Œ<code>Ind</code> ä¹Ÿæœ‰å½’çº³æ€§è´¨ï¼š</p>
<pre><code class="language-idris">indInd : (P : Ind a size -&gt; Type) -&gt;
    ((x : a) -&gt; (v : Vect (size x) (Ind a size)) -&gt; ((i : Fin (size x)) -&gt; P (index i v)) -&gt; P (MkInd x v)) -&gt;
    (n : Ind a size) -&gt;
    P n
indInd p f (MkInd x v) = f x v (\i =&gt; indInd p f (index i v))
</code></pre>
<p>ç›¸æ¯” <code>List</code> åªéœ€è¦ä¸€ä¸ªåç»­èŠ‚ç‚¹çš„å½’çº³ç»“æœï¼Œ <code>Ind</code> éœ€è¦æ‰€æœ‰å­æ ‘çš„å½’çº³ç»“æœå¹¶ç»„åˆèµ·æ¥ï¼Œè¿™é‡Œç”¨äº†ä¸€ä¸ª <code>i</code> æ¥ç´¢å¼•ç¬¬ <code>i</code> ä¸ªå­æ ‘å½’çº³ç»“æœ <code>P (index i v)</code>ã€‚</p>
<h2 id="w-ç±»å‹">W ç±»å‹</h2>
<p>ä¸Šè¿° <code>Ind</code> ä¾èµ– <code>Nat</code>, <code>Fin</code> å’Œ <code>Vect</code> çš„å®ç°ï¼Œå®ƒä»¬ç¼–ç äº†å­èŠ‚ç‚¹åˆ—è¡¨åŠå…¶ä¸‹æ ‡ã€‚è€Œ W ç±»å‹å°±æ˜¯åœ¨ <code>Ind</code> çš„æ€æƒ³åŸºç¡€ä¸Šç”¨æ›´åŸºç¡€çš„æ–¹å¼å®ç°äº†å‰è¿°çš„åˆ—è¡¨å’Œä¸‹æ ‡çš„ç¼–ç ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¾—è€ƒè™‘æ›´åŠ åº•å±‚çš„ç¼–ç ã€Œæ•°å­—ã€ä¸ã€Œæ•°ç»„ã€çš„åŠæ³•ã€‚è€Œæ°å·§ä»£æ•°æ•°æ®ç±»å‹æœ¬èº«å°±è•´å«ç€æ•°é‡çš„æ¦‚å¿µï¼Œç±»å‹æ‹¥æœ‰çš„å®ä¾‹æ•°é‡å°±å¯ä»¥çœ‹æˆæ˜¯ä¸‹æ ‡çš„æ•°é‡ä¸Šé™ï¼Œè€Œæ¯ä¸ªå…·ä½“å®ä¾‹å¯ä»¥çœ‹ä½œæ˜¯å…·ä½“çš„ä¸‹æ ‡ï¼Œåˆ©ç”¨å‡½æ•°å°±å¯ä»¥æŠŠä¸‹æ ‡æ˜ å°„åˆ°å„ä¸ªåˆ†æ”¯ä¸Šï¼š</p>
<pre><code class="language-idris"><span class="hljs-keyword">data</span> W : (a : Type) -&gt; (b : a -&gt; Type) -&gt; Type <span class="hljs-keyword">where</span>
    Sup : (x : a) -&gt; (b x -&gt; W a b) -&gt; W a b
</code></pre>
<p>ä»æŸç§è§’åº¦ä¸Šæ¥è¯´ä¸Šè¿° <code>Ind</code> ä¸­çš„ <code>Vect (size x) (Ind a size)</code> çš„ç”¨é€”å¯ä»¥çœ‹ä½œæ˜¯ <code>Fin (size x) -&gt; Ind a size</code>ï¼Œè€Œè¿™ <code>Fin (size x)</code> æŸç§ç¨‹åº¦ä¸Šæ¥è¯´å°±æ˜¯å¯¹ W ç±»å‹ä¸­ <code>b x</code> çš„ç‰¹åŒ–ï¼š</p>
<pre><code class="language-idris">IndByW : (a : Type) -&gt; (a -&gt; Nat) -&gt; Type
IndByW a size = W a (\x =&gt; Fin (size x))
</code></pre>
<p>å‚è€ƒ <code>Ind</code> çš„å½’çº³å®ç°ï¼Œå¯ä»¥å¾ˆç®€å•å†™å‡º W ç±»å‹çš„å½’çº³å®ç°ï¼š</p>
<pre><code class="language-idris">indW : (P : W a b -&gt; Type) -&gt;
    ((x : a) -&gt; (f : b x -&gt; W a b) -&gt; ((i : b x) -&gt; P (f i)) -&gt; P (Sup x f)) -&gt;
    (n : W a b) -&gt;
    P n
indW p f (Sup x v) = f x v (\i =&gt; indW p f (v i))
</code></pre>
<p>å’Œä¸Šé¢çš„ <code>Ind</code> ä¸€æ ·ï¼Œè¿™é‡Œä¸¾ä¸ªç”¨ W ç±»å‹æ„é€  <code>List</code> çš„ä¾‹å­ï¼š</p>
<pre><code class="language-idris">listIndex : (a : Type) -&gt; (Maybe a) -&gt; Type
listIndex _ Nothing = Void
listIndex _ (Just x) = ()

ListW : Type -&gt; Type
ListW a = W (Maybe a) (listIndex a)

nilW : ListW a
nilW = Sup Nothing absurd

consW : a -&gt; ListW a -&gt; ListW a
consW x xs = Sup (Just x) (\_ =&gt; xs)
</code></pre>
<h2 id="æœ‰å•¥ç”¨ï¼Ÿ">æœ‰å•¥ç”¨ï¼Ÿ</h2>
<p>æˆ‘è§‰å¾—å­¦ä¸€æ ·ä¸œè¥¿æœ€é‡è¦çš„åœ°æ–¹å°±æ˜¯äº†è§£åˆ°å®ƒæœ‰å•¥ç”¨ï¼Œä¸ºäº†äº†è§£åˆ°å®ƒæœ‰å•¥ç”¨ä¼šæœ‰æ›´å¤§çš„åŠ¨åŠ›å»ç ”ç©¶å’Œç”¨é€”å¯†åˆ‡ç›¸å…³çš„å®ƒçš„å½¢å¼ä¸ç‰¹æ€§ã€‚åœ¨æ–‡ç« çš„å¼€å¤´æåˆ°å®ƒå¯ä»¥ç”¨æ¥ç¼–ç ä»»æ„ Dependent Inductive Type ï¼Œè€Œåœ¨ç ”ç©¶ç±»å‹è®ºçš„æ—¶å€™æƒ³ä»å•¥ä¹Ÿæ²¡æœ‰ä¹‹ä¸­æ„é€ å‡ºä»»æ„ Dependent Inductive Type çš„æ—¶å€™ W ç±»å‹å°±æœ‰éå¸¸å¤§çš„ä¼˜åŠ¿ã€‚W çš„ç±»å‹å®šä¹‰å°±æ˜¯å®ƒå’Œå®ƒçš„å®ä¾‹çš„ Introduction Rulesï¼Œè€Œ <code>indW</code> å°±æ˜¯å®ƒçš„ Computation Rulesã€‚</p>
<p>è€Œåœ¨è¯­è¨€ä¹‹å¤–è®¾è®¡å¥½è¿™äº› Rules äº†ä»¥åæƒ³ç”¨å®ƒçœŸçš„æ¥ç¼–ç ç±»å‹è¿˜éœ€è¦ä¸€äº›è¾…åŠ©ç±»å‹ï¼Œæ¯”å¦‚ä¸Šé¢æ„é€  <code>ListW</code> æ‰€éœ€è¦ <code>Maybe</code>, <code>Void</code> å’Œ <code>()</code> ç±»å‹ã€‚æˆ‘ä»¬éœ€è¦è¿™äº›ç±»å‹æ¥æ‰¿è½½æ•°æ®å’Œä¸ºåˆ†æ”¯æä¾›ç´¢å¼•ï¼Œæ‰€å¹¸çš„æ˜¯è¿™äº›ç±»å‹å¹¶ä¸éœ€è¦å½’çº³ç»“æ„ï¼Œæ‰€ä»¥åªéœ€è¦ç®€å•çš„ <code>Void</code>, <code>()</code>, <code>Bool</code> å¤–åŠ  Dependent Pair å°±å¯ä»¥ç¼–ç äº†ã€‚æ¯”å¦‚ <code>Maybe</code> å°±å¯ä»¥ç¼–ç ä¸ºï¼š</p>
<pre><code class="language-idris">Maybe&#x27; : Type -&gt; Type
Maybe&#x27; a = (label : Bool ** <span class="hljs-keyword">case</span> label <span class="hljs-keyword">of</span> 
    True =&gt; Void
    False =&gt; a)
</code></pre>
<p>ç”¨ <code>True</code> å’Œ <code>False</code> çš„åºåˆ—ä¸ºæ¯ä¸ªæ„é€ å™¨å‘½åï¼Œç„¶åç”¨ Dependent Pair å’Œ Bool çš„ Elimination Rules æ¥æŠŠå‘½åæ˜ å°„åˆ°æ„é€ å™¨çš„å…·ä½“å‚æ•°ç±»å‹ä¸Šã€‚</p>
<blockquote>
<p>Reference: </p>
<p><a href="https://vinalx.github.io/articles/2019/03/w-type">Inductive type and W Type - VinaLx</a></p>
</blockquote>
</body>
</html>
