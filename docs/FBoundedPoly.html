<!DOCTYPE html><html lang="zh-CN" prefix="og: https://ogp.me/ns#">
<head >
<meta charset="utf-8"/>
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<title >
F-Bounded Polymorphism</title>
<link href="https://cdn.bootcdn.net/ajax/libs/KaTeX/0.13.13/katex.min.css" rel="stylesheet"><style >
body {
    max-width: 35em;
    margin: auto;
    width: 90%;
    margin-top: 10%;
    margin-bottom: 10%;
    color: #0B0E26;
    background: #FAFAFC;
    line-height: 2em;
    text-rendering: optimizeLegibility;
    text-align: justify;
}

html {
    scroll-behavior: smooth;
    font-size: calc(min(.35vw + 16px, 25px));
    font-family: -apple-system, BlinkMacSystemFont, Helvetica Neue, PingFang SC, Microsoft YaHei, Source Han Sans SC, Noto Sans CJK SC, WenQuanYi Micro Hei, sans-serif;
}

h1 {
    font-size: 2.5rem;
    color: #EF96AB;
    line-height: 1.5em;
}

h2 {
    margin-top: 2rem;
    line-height: 1.5em;
}

h1,
h2,
h3 {
    /* text-align: center; */
}

blockquote {
    color: gray;
    margin: 0;
    padding: 1px 0 1px 1.2em;
    border-left: .3em solid #EF96AB;
}

code,
pre {
    font-size: 0.9rem;
    line-height: 1.8em;
    font-family: "JetBrains Mono", "ç­‰è·æ›´çº±é»‘ä½“ SC", "Fira Code", Menlo, Monaco, source-code-pro, Courier New, Consolas, monospace;
    background: #FCF6FC;
    border-radius: 3px;
    padding-inline: 0.3em;
}

pre {
    overflow-x: auto;
    padding: 1em 1.5em;
}

pre>code {
    padding-inline: 0;
}

::-webkit-scrollbar,
.element::-webkit-scrollbar,
.element {
    /* opacity: 0.5; */
}

a {
    color: #02AEF1;
    text-decoration: none;
}

@media (prefers-color-scheme: dark) {
    body {
        color: #D8D8D6;
        background: #0E0E10;
    }
}

@media (prefers-color-scheme: dark) {

    pre,
    code {
        color: #D8D8D6;
        background: #0E0F1F;
    }
}

.hljs-keyword {
    color: #F288AF;
}

.hljs-comment {
    color: #929CA6;
}

.hljs-string {
    color: #0594A6;
}

.hljs-title {
    color: #4581D9;
}

.hljs-type,
.hljs-built_in {
    color: #fca311;
}</style>
</head>
<body >
<p >
<a href="https://iota.huohuo.moe">ğŸ HomepageğŸ </a> | <a href="https://github.com/niltok">ğŸ”¥GitHubğŸ”¥</a></p>
<h1 id="f-bounded-polymorphism">F-Bounded Polymorphism</h1>
<blockquote>
<p>å‰è¨€ï¼Œåœ¨å¾ˆä¹…ä»¥å‰çš„æŸä¸€å¤©ï¼Œæˆ‘åœ¨é­”æ³•åº—æ°´ç¾¤ï¼Œçœ‹åˆ°æœ‰äººæåˆ° F-Bounded Polymorphismï¼Œäºæ˜¯å»æœç´¢å¼•æ“æ‰¾åˆ°äº† <a href="https://blog.lishunyang.com/2020/09/f-bounded-polymorphism.html">è¿™ç¯‡æ–‡ç« </a> ã€‚è¯»å®Œä»¥åæ„Ÿè§‰æŒºæœ‰è¶£çš„å°±åˆ†äº«åˆ°äº†ç¾¤é‡Œï¼Œä¸è¿‡ç¾¤é‡Œäººè¯»å®Œäº§ç”Ÿçš„ç–‘æƒ‘ä¼¼ä¹æˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆè§£ç­”ã€‚äºæ˜¯è¿™ä¸¤å¤©å»è¯»äº† <a href="http://staff.ustc.edu.cn/~xyfeng/teaching/FOPL/lectureNotes/CookFBound89.pdf">åŸè®ºæ–‡</a>ï¼Œç»“æœå‘ç°é‚£ç¯‡ç½‘æ–‡å¯¹ F-Bounded Polymorphism çš„ç†è§£ä¼¼ä¹æœ‰ä¸€äº›åå·®â€¦â€¦</p>
</blockquote>
<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>
<p>å¿«é€Ÿåœ°æè¿°ä¸€ä¸‹å½¢å¼åŒ–é¢å‘å¯¹è±¡æ¨¡å‹ï¼š</p>
<h3 id="record-å­ç±»å‹">Record å­ç±»å‹</h3>
<pre><code class="language-typescript"><span class="hljs-keyword">type</span> A = {
    <span class="hljs-attr">x_1</span>: <span class="hljs-variable constant_">X_1</span>,
    <span class="hljs-attr">x_2</span>: <span class="hljs-variable constant_">X_2</span>,
    ...
    <span class="hljs-attr">x_n</span>: X_n
}

<span class="hljs-keyword">type</span> B = {
    <span class="hljs-attr">y_1</span>: <span class="hljs-variable constant_">Y_1</span>,
    <span class="hljs-attr">y_2</span>: <span class="hljs-variable constant_">Y_2</span>,
    ...
    <span class="hljs-attr">y_n</span>: Y_n,
    ...
    <span class="hljs-attr">y_m</span>: Y_m
}
</code></pre>
<p>å½“å¯¹äº <code>i</code> ç­‰äº <code>1</code> åˆ° <code>n</code> æ¥è¯´ <code>Y_i</code> éƒ½æ˜¯ <code>X_i</code> çš„å­ç±»å‹æ—¶ï¼Œå°±å¯ä»¥æŠŠ <code>B</code> å½“ä½œ <code>A</code> çš„å­ç±»å‹ã€‚</p>
<h3 id="å‡½æ•°å­ç±»å‹">å‡½æ•°å­ç±»å‹</h3>
<pre><code class="language-typescript"><span class="hljs-keyword">type</span> <span class="hljs-variable constant_">F1</span> = <span class="hljs-function">(<span class="hljs-params">x: X1</span>) =&gt;</span> <span class="hljs-variable constant_">Y1</span>

<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">F2</span> = <span class="hljs-function">(<span class="hljs-params">x: X2</span>) =&gt;</span> <span class="hljs-variable constant_">Y2</span>
</code></pre>
<p>å½“ <code>Y2</code> æ˜¯ <code>Y1</code> çš„å­ç±»å‹ä¸” <code>X1</code> æ˜¯ <code>X2</code> çš„å­ç±»å‹æ—¶ï¼Œ <code>F2</code> å°±æ˜¯ <code>F1</code> çš„å­ç±»å‹ã€‚å› ä¸º <code>F2</code> æƒ³æ›¿ä»£ <code>F1</code> çš„è¯éœ€è¦æ¥æ”¶èƒ½æ›¿ä»£ <code>X2</code> çš„ <code>X1</code> å¹¶è¿”å›èƒ½æ›¿ä»£ <code>Y1</code> çš„ <code>Y2</code>ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ä¿¡æ¯åœ¨æµåŠ¨çš„æ—¶å€™åªä¼šå˜å°‘ä¸ä¼šå˜å¤šã€‚</p>
<blockquote>
<p>æœ‰ç–‘é—®çš„è¯å¯ä»¥å»çœ‹çœ‹åå˜ä¸é€†å˜ç›¸å…³çŸ¥è¯†ã€‚</p>
</blockquote>
<h3 id="å¸¦çº¦æŸæ³›å‹">å¸¦çº¦æŸæ³›å‹</h3>
<pre><code class="language-typescript"><span class="hljs-keyword">type</span> F&lt;T <span class="hljs-keyword">extends</span> A&gt; = <span class="hljs-function">(<span class="hljs-params">x: T</span>) =&gt;</span> Y
</code></pre>
<p>æ³›å‹å‚æ•° <code>T</code> å¿…é¡»æ˜¯ <code>A</code> çš„å­ç±»å‹ã€‚</p>
<h2 id="ç¢°åˆ°çš„é—®é¢˜">ç¢°åˆ°çš„é—®é¢˜</h2>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="language-typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Comparable</span> = {
    <span class="hljs-title function_">compareTo</span>(<span class="hljs-attr">other</span>: <span class="hljs-title class_">Comparable</span>): <span class="hljs-built_in">number</span>
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Num</span> = {
    <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span>,
    <span class="hljs-title function_">compareTo</span>(<span class="hljs-attr">other</span>: <span class="hljs-title class_">Num</span>): <span class="hljs-built_in">number</span>
}

<span class="hljs-keyword">function</span> min&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Comparable</span>&gt;(<span class="hljs-attr">a</span>: T, <span class="hljs-attr">b</span>: T): T {
    <span class="hljs-keyword">return</span> (a.<span class="hljs-title function_">compareTo</span>(b) &lt; <span class="hljs-number">0</span>) ? a : b
}
</code></pre>
<p>æŒ‰ç…§äººç±»çš„ç›´è§‰æ¥è¯´ <code>Num</code> åº”è¯¥æ˜¯ <code>Comparable</code> çš„å­ç±»å‹ï¼Œå¯ä»¥ç”¨äº <code>min</code> çš„å‚æ•°ï¼Œç”šè‡³è¿ Typescript ç¼–è¯‘å™¨éƒ½è®¤ä¸ºè¿™æ˜¯å¯¹çš„ï¼Œä½†æ˜¯æ‰‹åŠ¨åšä¸‹ç±»å‹æ£€æŸ¥å°±ä¼šå‘ç°é—®é¢˜æ‰€åœ¨ï¼š</p>
<p>å¦‚æœ <code>Num</code> æ˜¯ <code>Comparable</code> çš„å­ç±»å‹ï¼Œé‚£ä¹ˆ <code>compareTo(other: Num)</code> å°±æ˜¯ <code>compareTo(other: Comparable)</code> çš„å­ç±»å‹ã€‚æ‰€ä»¥æŒ‰ç…§å‡½æ•°å‚æ•°é€†å˜çš„è§„åˆ™ï¼Œ<code>Comparable</code> åº”è¯¥æ˜¯ <code>Num</code> çš„å­ç±»å‹ã€‚è¿™å°±ä¼šå’Œæˆ‘ä»¬å…ˆå‰çš„å‡è®¾çŸ›ç›¾ã€‚</p>
<blockquote>
<p>Typescript ç¼–è¯‘å™¨è®¤ä¸ºè¿™æ˜¯å¯¹çš„ï¼Œå¬ä¸Šå»æŒºå¥‡æ€ªï¼Œæ¯•ç«Ÿåœ¨ Typescript ä¸­å‡½æ•°å‚æ•°é€†å˜æ˜¯ä¸¥æ ¼æ£€æŸ¥çš„ï¼Œç„¶è€Œæˆ‘å‡†å¤‡æ Issue çš„æ—¶å€™å‘ç°è¿™æ˜¯ä¸ªå¸¸è§è¢«è®¤ä¸ºæ˜¯ Bug çš„è¡Œä¸ºã€‚å®é™…ä¸Šè¿™ä¸ªé—®é¢˜åœ¨ 2017 å¹´å‡½æ•°å‚æ•°é€†å˜æ£€æŸ¥åŠŸèƒ½è¢«å®ç°çš„æ—¶å€™å°±æœ‰æ‰€è€ƒè™‘ï¼Œå¦‚æœä¸¥æ ¼æ£€æŸ¥æ–¹æ³•å‚æ•°é€†å˜çš„è¯å¯¹å½“æ—¶æ³›å‹åº“ä¼šäº§ç”Ÿä¸¥é‡çš„å…¼å®¹æ€§é—®é¢˜æ‰€ä»¥è¢«å½“æˆç‰¹ä¾‹å¤„ç†äº†ã€‚</p>
<p>Reference: <a href="https://github.com/microsoft/TypeScript/pull/18654">Typescript#18654</a></p>
</blockquote>
<h2 id="f-bounded-polymorphism-1">F-Bounded Polymorphism</h2>
<p>ç†Ÿæ‚‰ Java çš„å°ä¼™ä¼´å¯èƒ½ä¼šè¯´ï¼šã€ŒJava é‡Œçš„ Comparable å¯ä¸æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼ã€</p>
<pre><code class="language-typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Comparable</span>&lt;T&gt; = {
    <span class="hljs-title function_">compareTo</span>(<span class="hljs-attr">other</span>: T): <span class="hljs-built_in">number</span>
}

<span class="hljs-keyword">function</span> min&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Comparable</span>&lt;T&gt;&gt;(<span class="hljs-attr">a</span>: T, <span class="hljs-attr">b</span>: T): T {
    <span class="hljs-keyword">return</span> (a.<span class="hljs-title function_">compareTo</span>(b) &lt; <span class="hljs-number">0</span>) ? a : b
}
</code></pre>
<p>è¿™æ ·ä¸€æ¥ <code>Comparable&lt;Num&gt;</code> ä¸­çš„å‡½æ•°æˆå‘˜å°±æ˜¯ <code>compareTo(other: Num)</code> ï¼Œå’Œ <code>Num</code> ä¸­çš„ <code>compareTo</code> å®Œç¾åŒ¹é…ã€‚äºæ˜¯ <code>Num</code> å°±æ˜¯ <code>Comparable&lt;Num&gt;</code> çš„å­ç±»å‹äº†ï¼Œæ‰€ä»¥ <code>Num</code> èƒ½æ»¡è¶³ <code>min</code> å‡½æ•°çš„ç±»å‹å‚æ•°ä¸­çš„ <code>T extends Comparable&lt;T&gt;</code> çº¦æŸï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ç±»å‹æ£€æŸ¥äº†ã€‚</p>
<p>è¿™ä¸ª <code>T extends Comparable&lt;T&gt;</code> çœ‹ä¸Šå»æŒºå¥‡æ€ªçš„ï¼Œå®šä¹‰å¯¹ <code>T</code> çš„çº¦æŸä¸­æœ‰å¯¹ <code>T</code> çš„å¼•ç”¨ï¼Œä½†æ‰‹å·¥ä»£å…¥ç±»å‹ä»¥åä¼šå‘ç°å®ƒå€’ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚è¿™ä¸ªéå¸¸æœ‰é€’å½’é£å‘³çš„çº¦æŸå°±å« F-Bounded Quantificationã€‚è€Œåˆ©ç”¨è¯¥çº¦æŸå®šä¹‰çš„å¤šæ€ï¼Œå°±å« F-Bounded Polymorphismã€‚</p>
<p>è€Œç²¾é€š Typescript çš„å°ä¼™ä¼´è‚¯å®šä¼šæƒ³åˆ°ï¼Œè¿™é‡Œçš„ Best Practice å®é™…ä¸Šæ˜¯ä½¿ç”¨ <code>this</code> ç±»å‹ï¼š</p>
<pre><code class="language-typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Comparable</span> {
    <span class="hljs-title function_">compareTo</span>(<span class="hljs-attr">other</span>: <span class="hljs-variable language_">this</span>): <span class="hljs-built_in">number</span>
}

<span class="hljs-keyword">function</span> min&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Comparable</span>&gt;(<span class="hljs-attr">a</span>: T, <span class="hljs-attr">b</span>: T): T {
    <span class="hljs-keyword">return</span> (a.<span class="hljs-title function_">compareTo</span>(b) &lt; <span class="hljs-number">0</span>) ? a : b
}
</code></pre>
<p>è¿™å®é™…ä¸Šå°±æ˜¯ Typescript ä¸­ F-Bounded Polymorphism çš„è¯­æ³•ç³–ã€‚</p>
<p>è‡³äºåœ¨ Java ä¸­ï¼Œè¿™ä¸€æ“ä½œä¹Ÿè¢«æ ‡å‡†åº“å¤§é‡ä½¿ç”¨ï¼Œæœ€ä¸ºå¸¸è§çš„ä¾¿æ˜¯ <code>Comparable</code> æ¥å£ï¼š</p>
<pre><code class="language-java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Comparable</span>&lt;T&gt; {
    <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(T other)</span>;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Num</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparable</span>&lt;Num&gt; {
    <span class="hljs-type">int</span> value;
    <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Num other)</span> {
        <span class="hljs-keyword">return</span> value - other.value;
    }
    <span class="hljs-keyword">static</span> &lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Comparable</span>&lt;T&gt;&gt; T <span class="hljs-title function_">min</span><span class="hljs-params">(T a, T b)</span> {
        <span class="hljs-keyword">return</span> (a.compareTo(b) &lt; <span class="hljs-number">0</span>) ? a : b;
    }
}
</code></pre>
<p>ç±»ä¼¼çš„è¿˜æœ‰ C++ ä¸­çš„ CRTPã€‚</p>
<h2 id="faq">FAQ</h2>
<h3 id="ä»€è«äº‹-f">ä»€è«äº‹ &quot;F&quot;</h3>
<p>åŸè®ºæ–‡ä¸­å®šä¹‰ F-Bounded Quantification çš„æ—¶å€™ç”¨äº† <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">âˆ€</mi><mi>t</mi><mo>âŠ†</mo><mi>F</mi><mo stretchy="false">[</mo><mi>t</mi><mo stretchy="false">]</mo><mi mathvariant="normal">.</mi><mi>Ïƒ</mi></mrow><annotation encoding="application/x-tex">\forall t \sube F[t]. \sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8304em;vertical-align:-0.136em;"></span><span class="mord">âˆ€</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âŠ†</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">[</span><span class="mord mathnormal">t</span><span class="mclose">]</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.03588em;">Ïƒ</span></span></span></span> å…¶ä¸­çš„ t å°±æ˜¯ä½œä¸ºå‚æ•°çš„å­ç±»å‹ï¼Œè€Œ F å°±æ˜¯æœ‰ç€å­ç±»å‹ <code>t</code> ä½œä¸ºæ³›å‹å‚æ•°çš„çˆ¶ç±»å‹ï¼Œå°±æ¯”å¦‚ä¸Šé¢ä¸¾ä¾‹å­ç”¨çš„ <code>T extends Comparable&lt;T&gt;</code>ã€‚<strong>æ³¨æ„ F å¹¶ä¸æ˜¯é‚£ç¯‡ç½‘æ–‡ä¸­æ‰€è¯´çš„é‚£æ ·ä¸ºä¸€ä¸ªå‡½æ•°ï¼</strong></p>
<h3 id="å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹">å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹</h3>
<p>åœ¨ <code>T extends F&lt;T&gt;</code> ä¸­ï¼Œåªæœ‰ <code>F</code> æ˜¯ free çš„ï¼Œæ‰€ä»¥å¿…ç„¶æ˜¯å…ˆæœ‰ <code>F</code> å†æœ‰ F-Bounded Quantificationã€‚ä¸è¿‡å¯¹äºå…·ä½“çš„ä½œä¸ºå­ç±»å‹çš„ <code>T</code> æ¥è¯´ï¼Œå€’æ˜¯è¦çœ‹ç±»å‹ç³»ç»Ÿå¯¹ç»§æ‰¿çš„è¦æ±‚äº†ã€‚åƒ Typescript è¿™ç§ structural typing å¹¶ä¸åœ¨æ„å…ˆå®šä¹‰æ¥å£è¿˜æ˜¯å­ç±»å‹ï¼Œä½†åƒ Java é‚£ç§ nominal typing å°±ä¼šè¦æ±‚ç»§æ‰¿æ—¶ç»™å®šæ¥å£ï¼Œæ‰€ä»¥éœ€è¦å…ˆå®šä¹‰æ¥å£ã€‚</p>
</body>
</html>
